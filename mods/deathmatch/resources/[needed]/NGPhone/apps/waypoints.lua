WaypointPage = "main"

WayPointLocs = {
	['Trabajos'] = { 
		-- Los Santos
		{ "Los Santos - Mecanico", 2277.06, -2359.07, 13.58 },
		{ "Los Santos - Rappi", 1947.95, -1364.64, 18.58 },
		{ "Los Santos - Taxista", 2001.08, -1280.89, 23.98 },
		{ "Los Santos - Busetero", 1767.06, -1905.85, 13.57 },
		{ "Los Santos - Piloto", 2002.29, -2294.41, 13.55 },
		{ "Los Santos - Camionero", 2176.48, -2259.19, 14.77 },
		{ "Los Santos - Mecanico 1", 2276.59, -2359.15, 13.55 },
		{ "Los Santos - Mecanico 2", 2642.31, -2033.67, 13.55 },
		{ "Los Santos - Basurero", 2192.4, -1991.12, 13.55 },
		{ "Los Santos - Pescador", 2157.8, -97.63, 2.81 },
		{ "Los Santos - Medico", 1178.47, -1327.87, 14.12 },
		{ "Los Santos - Policia", 1575.9, -1634.39, 13.56 },
		{ "Los Santos - Drifter", 1813.06, -1900.46, 13.57 },
		{ "Los Santos - Criminal 1", 1625.8, -1509.34, 13.6 },
		{ "Los Santos - Criminal 2", 2141.75, -1733.24, 17.29 },
		{ "Los Santos - Criminal 3", 2142.6, -1583.98, 14.35 },
		--{ "Los Santos - ",  },
		-- Las Venturas

		{ "Las Venturas - Camionero", 1630.01, 966.79, 10.82 },
		{ "Las Venturas - Piloto", 1652.18, 1614.19, 10.82 },
		{ "Las Venturas - Medico", 1615.18, 1820.37, 10.83 },
		{ "Las Venturas - Mecanico", 1658.36, 2198.95, 10.82 },
		{ "Las Venturas - Poicia ", 2295.71, 2463.91, 10.82 },
		{ "Las Venturas - Drifter 1", 2379.3, 2542.58, 10.82 },
		{ "Las Venturas - Drifter 2", 1982.92, 1757.2, 11.76 },
		{ "Las Venturas - Drifter 3", 2238.61, 1957.37, 32.01 },
		{ "Las Venturas - Drifter 4", 2345.04, 1393.39, 42.82 },
		{ "Las Venturas - Criminal 1", 2124.99, 889.09, 11.18 },
		{ "Las Venturas - Criminal 2", 1042.96, 2154.09, 10.82 },
		{ "Las Venturas - Criminal 3", 2216.86, 2711.93, 10.82 },
		{ "Las Venturas - Criminal 4", 2461.1, 1324.98, 10.82 },
		--{ "Las Venturas - ",  },
		-- San Fierro
		{ "San Fierro - Piloto", -1254.39, 16.26, 14.15 },
		{ "San Fierro - Camionero", -2137.18, -238.66, 35.32 },
		{ "San Fierro - Camionero 2", -2436.83, 2321.47, 4.98 },
		{ "San Fierro - Policia", -1615.36, 682.35, 7.19 },
		{ "San Fierro - Criminal 1", -1832.55, 584.73, 35.16 },
		{ "San Fierro - Criminal 2", -2529.98, -623.26, 132.75 },
		{ "San Fierro - Drifter 1", -2035.54, -121.26, 35.18 },
		{ "San Fierro - Drifter 2", -2945.98, 472.57, 4.92 },
		--{ "San Fierro - ",  },
	},
	
	
	['Lugares'] = { 
		-- San fierro
		['San Fierro'] = {
			{ "Wheel Arch Angels Modshop", -2712.92, 217.36, 4.25 },
			{ "Transfender Modshop", -1936.02, 234.95, 34.31 },
			{ "Pay n' Spray", -1904.97, 273.14, 41.05 },
			{ "Sports Car Shop", -1972.91, 286.07, 35.17 },
			{ "San Fierro Medical Center", -2661.14, 606.22, 13.86 },
		},
		-- Los Santos
		['Los Santos'] = {
			-- { "Name", x, y, z }
			{ "Ammunation(central)", 1366.23, -1278.39, 13.6 },
			{ "Ammunation(barrio)", 2400.25, -1981.27, 13.55 },
			{ "Banco 1", 914.4, -995.55, 38.19 },
			{ "Banco 2(busetero)",1831.11, -1842.63, 13.58},
			{ "Tienda de Alcohol", 251.87, -56.37, 1.57 },
			{ "Tienda carros caros", 551.84, -1272.28, 17.3 },
			{ "Tienda carros baratos", 2131.75, -1144.93, 24.75 },
			{ "Tienda carros Colombianos", 1147.77, -1428.24, 15.8 },
			{ "Tienda carros Grandes", 1147.77, -1428.24, 15.8 },
			{ "Tienda de Motos", 1802.8, -1914.98, 13.4 },
			{ "Tienda de aviones", 1998.8, -2359.83, 13.55 },
			{ "Compra-Venta", 1984.87, -1994.64, 13.55},
			{ "Tienda de skins(central)", 1458.35, -1137.88, 24.02 },
			{ "Tienda de skins(barrio)", 2244.52, -1663.91, 15.48 },
			{ "Tienda de skins-Criminal", 1666.6, -1509.69, 13.55 },
			{ "Hospital Central", 1184.45, -1322.87, 13.57 },
			{ "Hospital de Groove", 2001, -1446.85, 13.56 },
			{ "Puteadero",2229.77, -1159.61, 25.81},
			{ "GYM",2228.82, -1722.4, 13.56},
			{ "SA Customs (banco)", 1041.3, -1032.18, 32.09 },
			{ "SA Customs (aeropuerto)", 1937.03, -2302.26, 13.55 },
			{ "SA Customs (barrio)", 2644.5, -2020.54, 13.55 },
			{ "Pay n' Spray", 1025.46, -1031.82, 32.02 },
			{ "Pay n' Spray", 2077.75, -1831.17, 13.38 },
			{ "Pay n' Spray", 1921.97, -2247.42, 13.55 },

		},

	},
	
	['Players'] = { },
	['Custom'] = { },
}

function appFunctions.waypoints:onPanelLoad ( )
	WaypointPage = "main"
	guiGridListClear ( pages['waypoints'].grid  )
	WayPointLocs.Custom = { }
	WayPointLocs.Players = { }
	
	for i, v in pairs ( WayPointLocs ) do
		local r = guiGridListAddRow ( pages['waypoints'].grid  )
		guiGridListSetItemText ( pages['waypoints'].grid , r, 1, tostring ( i ), false, false )
	end
	
	local waypns = fromJSON ( getSetting ( "user_waypoints" ) );
	if ( type ( waypns ) == "table" ) then 
		for i,v in pairs ( waypns ) do 
			table.insert(WayPointLocs.Custom,v);
			--outputDebugString(string.format("Loading waypoint '%s' (%s, %s, %s)",unpack(v)))
		end 
	end 
	
	for _, p in pairs ( getElementsByType ( "player" ) ) do
		if ( p ~= localPlayer ) then
			local x, y, z = getElementPosition ( p )
			table.insert(WayPointLocs.Players,{getPlayerName(p),x,y,z})
		end
	end 
end

function appFunctions.waypoints:addWaypoint ( )
	local name = guiGetText ( pages['waypoints'].add_name )
	if ( name:gsub ( " ", "" ) == "" ) then
		return exports.NGMessages:sendClientMessage ( "Invalid name", 255, 255, 0 )
	elseif ( appFunctions.waypoints:waypointExists ( name ) ) then
		return exports.NGMessages:sendClientMessage ( "A waypoint with this name already exists", 255, 255 ,0 )
	end
	
	local x, y, z = getElementPosition ( localPlayer ) 
	table.insert ( WayPointLocs.Custom, { name, x, y, z } )
	updateSetting ( "user_waypoints", toJSON ( WayPointLocs.Custom ) )
	exports.NGMessages:sendClientMessage ( "You have added the '"..tostring(name).."' waypoint!", 0, 255, 0 )
	appFunctions.waypoints:onPanelLoad ( )
	guiSetText ( pages['waypoints'].add_name, '' )
end

function appFunctions.waypoints:waypointExists ( n )
	local n = tostring ( n ):lower ( )
	for i, v in pairs ( WayPointLocs.Custom ) do
		if ( tostring ( v[1] ):lower ( ) == n ) then
			return true
		end
	end
	return false
end
